<!DOCTYPE html>


<script src="yadacoinpoolstatic/lib/jquery/dist/jquery.js"></script>
<script src="yadacoinpoolstatic/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<link href="yadacoinpoolstatic/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

<body>
    <div class="header">
      <div><img src="yadacoinpoolstatic/img/logo.ico"> YADA MINING POOL</div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>POOL HASH RATE</b></h5>
        <div id="pool-hash-rate"></div>
        <div id="pool-perecentage"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>BLOCKS FOUND</b></h5>
        <div id="pool-blocks-found"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>BLOCK FOUND EVERY</b></h5>
        <div id="pool-avg-block-time"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>LAST BLOCK FOUND BY POOL</b></h5>
        <div id="pool-last-block"></div>
        <h5 id="pool-last-block-time"></h5>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>NETWORK HASH RATE</b></h5>
        <div id="avg-network-hash-rate"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>DIFFICULTY</b></h5>
        <div id="network-difficulty"></div>
        <div id="current-network-hash-rate"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>BLOCKCHAIN HEIGHT</b></h5>
        <div id="network-height"></div>
        <h5 id="network-last-block"></h5>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>BLOCK REAWORD</b></h5>
        <h4><div>MINERS: <b><span  id="miners-reward"></span></b></div></h4>
        <h4><div>MASTER NODES: <b><span  id="master-nodes-reward"></span></b></div></h4>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>CONNECTED MINERS / WORKERS</b></h5>
        <div><span id="pool-worker-count"></span> / <span id="pool-miner-count"></span></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>POOL FEE</b></h5>
        <div id="pool-fee"></div>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>MINIMUM PAYOUT</b></h5>
        <div id="pool-min-payout"></div>
        <h5 id="pool-payout-frequency"></h5>
      </div>
    </div>
    <div class="column">
      <div class="box">
        <h5><b>PAYOUT SCHEME</b></h5>
        <div id="pool-payout-scheme"></div>
      </div>
    </div>
    <div class="column2">
      <div class="box2">
        <script src="https://widgets.coingecko.com/coingecko-coin-ticker-widget.js"></script>
        <coingecko-coin-ticker-widget currency="usd" coin-id="yadacoin" locale="en"></coingecko-coin-ticker-widget>
      </div>
    </div>
    <div class="column2">
      <div class="box3">
        <h5><b><center>HOW TO START</center></b></h5>
        <div>Create wallet</div>
        <div>Download XMRigCC</div>
        <div>XMRigCC config.json settings:</div>
        <h5>"algo": "rx/yada",</h5>
        <h5>"url": "<span id="pool-url">"</span>",</h5>
        <h5>"user": "Your wallet address.Worker ID",</h5>
        <h5>"keepalive": true,</h5>
      </div>
    </div>
    <div class="column3">
        <center>
          <li><button style="display: inline" class="button" role="button"><a href="https://discord.gg/MWwq27j5tX">Discord</a></button></li>
          <li><button style="display: inline" class="button" role="button"><a href="https://miningpoolstats.stream/yadacoin">MiningPoolStats</a></button></li>
          <li><button style="display: inline" class="button" role="button"><a href="https://yadacoin.io/app">Official Wallet</a></button></li>
          <li><button style="display: inline" class="button" role="button"><a href="https://github.com/Bendr0id/xmrigCC/releases">XMRigCC</a></button></li>
        </center>

      <h2>POOL BLOCKS</h2>
      <table id="blocks-table">
          <tr>
              <th>Time Found</th>
              <th>Height</th>
              <th>Reward</th>
              <th>Block Hash</th>
              <th>Status</th>
          </tr>
      </table>
      <center><button class="button" id="loadMore">Load More Blocks</button></center>

      <h2>MINER STATISTICS</h2>
      <form method="GET" action="." id="form">
        <input type="text" name="address" id="address" placeholder="address" style="width: 75%; height: 35px; float:left;" />
        <button class="button">Get stats</button>
      </form>
          <div class="column2">
              <table id="miner-stats-table" class="table"></table>
          </div>
          <div class="column2">
              <div id="miner-pay-container"></div>
          </div>
          <div class="column2">
              <div id="est-profit-container"></div>
          </div>
      <div id="payouts-table-container">
        <table id="payouts-table" class="table">
        </table>
      </div>
      <div id="pagination-container">
        <ul id="pagination" class="pagination"></ul>
      </div>
    </div>
</body>

<script type="text/javascript">
    function formatHashRate(hashrate) {
        let unit = 'H/s';

        if (hashrate >= 1000000) {
            hashrate /= 1000000;
            unit = 'MH/s';
        } else if (hashrate >= 1000) {
            hashrate /= 1000;
            unit = 'KH/s';
        }

        return hashrate.toFixed(2) + ' ' + unit;
    }

    $(document).ready(function () {
        $.get('/pool-info').then((data) => {
            $('#pool-hash-rate').html(formatHashRate(data.pool.hashes_per_second));
            if (data.pool.blocks.length > 0) {
                var newDate = new Date();
                newDate.setTime(data.pool.blocks[0].time * 1000);
                dateString = newDate.toLocaleString();
                $('#pool-last-block').html(data.pool.blocks[0].index);
                $('#pool-last-block-time').html(dateString);
            }
            $('#pool-miner-count').html(data.pool.miner_count);
            $('#pool-worker-count').html(data.pool.worker_count);
            $('#pool-payout-scheme').html(data.pool.payout_scheme);
            $('#pool-fee').html((data.pool.pool_fee * 100).toFixed(2) + '%');
            $('#pool-blocks-found').html(data.pool.blocks_found);
            $('#pool-min-payout').html(data.pool.min_payout + ' YDA');
            $('#pool-url').html(data.pool.url);
            $('#pool-perecentage').html('(' + data.pool.pool_perecentage.toFixed(2) + ' %)');
            $('#pool-avg-block-time').html(data.pool.avg_block_time);
            $('#network-difficulty').html(data.network.difficulty.toFixed(3));
            $('#network-height').html(data.network.height);
            var blockReward = parseFloat(data.network.reward);
            var MinersReward = (90 / 100) * blockReward;
            var NodesReward = (10 / 100) * blockReward;
            $('#miners-reward').html(MinersReward.toFixed(2) + ' YDA');
            $('#master-nodes-reward').html(NodesReward.toFixed(2) + ' YDA');
            var newDate = new Date();
            newDate.setTime(data.network.last_block * 1000);
            dateString = newDate.toLocaleString();
            $('#network-last-block').html(dateString);
            $('#avg-network-hash-rate').html(formatHashRate(data.network.avg_hashes_per_second));
            $('#current-network-hash-rate').html(formatHashRate(data.network.current_hashes_per_second));
            var poolAddress = data.pool.pool_address;

            function formatTime(seconds) {
              const minutes = Math.floor(seconds / 60);
              const hours = Math.floor(minutes / 60);

              if (hours > 0) {
                return hours + ' hour(s)';
              } else if (minutes > 0) {
                return minutes + ' minute(s)';
              } else {
                return seconds + ' second(s)';
              }
            }

            const payoutFrequency = data.pool.payout_frequency;
            const formattedFrequency = formatTime(payoutFrequency);
            $('#pool-payout-frequency').html('Payout every: ' + formattedFrequency);

                $.get('/pool-blocks').then((data) => {
                    if (data.blocks.length === 0) return $('#blocks-table').html('<tr><th>Time Found</th><th>Height</th><th>Reward</th><th>Block Hash</th><th>Status</th></tr>');
                    for (var i = 0; i < data.blocks.length; i++) {
                        var newDate = new Date();
                        newDate.setTime(data.blocks[i].time * 1000);
                        dateString = newDate.toLocaleString();
                        var foundDate = new Date();
                        foundDate.setTime(data.blocks[i].found_time * 1000);
                        foundDateString = foundDate.toLocaleString();
                        var reward = getRewardFromTransactions(data.blocks[i].transactions, poolAddress);
                        var status = data.blocks[i].status;
                        
                        var statusColor = '';
                        if (status === 'Pending') {
                            statusColor = 'orange';
                        } else if (status === 'Accepted') {
                            statusColor = 'green';
                        } else if (status === 'Orphan') {
                            statusColor = 'red';
                        }

                        $('#blocks-table').append('<tr><td>' + foundDateString + '</td><td>' + data.blocks[i].index + '</td><td>' + reward + '</td><td><a target="_blank" href="https://yadacoin.io/explorer?term=' + data.blocks[i].hash + '">' + data.blocks[i].hash + '</a></td><td style="color:' + statusColor + '">' + status + '</td></tr>');
                    }

                    function getRewardFromTransactions(transactions, poolAddress) {
                        var highestReward = 0.0;

                        for (var i = 0; i < transactions.length; i++) {
                            for (var j = 0; j < transactions[i].outputs.length; j++) {
                                if (transactions[i].outputs[j].to === poolAddress) {
                                    var currentReward = transactions[i].outputs[j].value;
                                    if (currentReward > highestReward) {
                                        highestReward = currentReward;
                                    }
                                }
                            }
                        }
                        return highestReward + ' YDA';
                    }

                    var pagelength = 10;
                    var pageIndex = 1;
                    var selector = "tr:gt(" + pagelength + ")";
                    $(selector).hide();

                    $("#loadMore").click(function () {
                        var itemsCount = ((pageIndex * pagelength) + pagelength);
                        var selector = "tr:lt(" + itemsCount + ")";
                        $(selector).show();
                        pageIndex++;
                    });
                });
            });

            $('#form').submit(function (e) {
                e.preventDefault();

                $.get('/pool-info').then((poolData) => {
                    const marketLastBTC = poolData.market.last_btc;
                    const marketLastUSDT = poolData.market.last_usdt;
                    const currentNetHashrate = poolData.network.current_hashes_per_second;
                    const avgNetHashrate = poolData.network.avg_hashes_per_second;

                    $.get('/payouts-for-address?address=' + $('#address').val()).then((payoutData) => {
                        var currentPage = 1;
                        createPayoutsTable(payoutData, currentPage);
                        createMinerPayTable(payoutData, marketLastBTC, marketLastUSDT);
                    });

                    $.get('/miner-stats-for-address?address=' + $('#address').val()).then((minerData) => {
                        const minerHashrate = minerData.total_hashrate;
                        createMinerStatsTable(minerData);
                        createEstMiningProfitTable(marketLastBTC, marketLastUSDT, currentNetHashrate, avgNetHashrate, minerHashrate);
                    });
                });
            });

            function createPayoutsTable(data, currentPage) {
              var itemsPerPage = 10;
              var startIndex = (currentPage - 1) * itemsPerPage;
              var endIndex = startIndex + itemsPerPage;

              if (data.results.length === 0) {
                $('#payouts-table').html('<tr><th>Time Sent</th><th>For Block</th><th>TXN ID</th><th>Amount</th></tr>');
              } else {
                $('#payouts-table').html('');
                $('#payouts-table').append('<tr><th>Time Sent</th><th>For Block</th><th>TXN ID</th><th>Amount</th></tr>');

                for (var i = startIndex; i < data.results.length && i < endIndex; i++) {
                  var selectOutput = {};
                  var newDate = new Date();
                  newDate.setTime(data.results[i]['txn'].time * 1000);
                  dateString = newDate.toLocaleString();

                  var blockIndex = Array.isArray(data.results[i].index) ? data.results[i].index.join(', ') : data.results[i].index;

                  for (var j = 0; j < data.results[i]['txn'].outputs.length; j++) {
                    if (data.results[i]['txn'].outputs[j].to === $('#address').val()) {
                      selectOutput = data.results[i]['txn'].outputs[j];
                    }
                  }

                  $('#payouts-table').append('<tr><td>' + dateString + '</td><td>' + blockIndex + '</td><td><a target="_blank" href="https://yadacoin.io/explorer?term=' + data.results[i]['txn'].id + '">' + data.results[i]['txn'].id + '</a></td><td>' + parseFloat(selectOutput.value).toFixed(8) + ' YDA' + '</td></tr>');
                }
              }

              var totalPages = Math.ceil(data.results.length / itemsPerPage);
              var maxVisiblePages = 10;
              var pagination = $('#pagination').html('');
              var startPage = 1;

              if (currentPage > maxVisiblePages / 2) {
                startPage = currentPage - Math.floor(maxVisiblePages / 2);
              }

              var endPage = startPage + maxVisiblePages - 1;
              if (endPage > totalPages) {
                endPage = totalPages;
                startPage = endPage - maxVisiblePages + 1;
                if (startPage < 1) {
                  startPage = 1;
                }
              }

              for (var page = startPage; page <= endPage; page++) {
                var pageLink = $('<a class="page-link" href="#">' + page + '</a>');
                var pageItem = $('<li class="page-item"></li>').append(pageLink);
                if (page === currentPage) {
                  pageItem.addClass('active');
                }

                pagination.append(pageItem);
              }

              $('#pagination li').on('click', function () {
                currentPage = parseInt($(this).text());
                createPayoutsTable(data, currentPage);
                $('html, body').animate({
                  scrollTop: $('#payouts-table-container').offset().top
                }, 'slow');
              });
            }

            function createMinerStatsTable(data) {
              if (data.miner_stats.length === 0) {
                return $('#miner-stats-table').html('<tr><th>Worker Name</th><th>Hashrate</th><th>Shares</th><th>Hashes</th><th>Status</th></tr>');
              }

              $('#miner-stats-table').html('');
              $('#miner-stats-table').append('<tr><th>Worker Name</th><th>Hashrate</th><th>Shares</th><th>Hashes</th><th>Status</th></tr>');

              for (var i = 0; i < data.miner_stats.length; i++) {
                var workerName = data.miner_stats[i].worker_name;
                var hashrate = formatHashRate(data.miner_stats[i].worker_hashrate);
                var shares = data.miner_stats[i].worker_share;
                var hashes = data.miner_stats[i].worker_hash;
                var status = data.miner_stats[i].status;

                var statusColor = '';
                if (status === 'Online') {
                    statusColor = 'green';
                } else if (status === 'Offline') {
                    statusColor = 'red';
                }

                var row = '<tr><td>' + workerName + '</td><td>' + hashrate + '</td><td>' + shares + '</td><td>' + hashes + '</td><td style="color:' + statusColor + '">' + status + '</td></tr>';
                $('#miner-stats-table').append(row);
              }

              var totalHashrate = formatHashRate(data.total_hashrate);
              var totalShares = data.total_share;
              var totalHashes = data.total_hash;

              var totalRow = '<tr><td><b>Total:</b></td><td>' + totalHashrate + '</td><td>' + totalShares + '</td><td>' + totalHashes + '</td><td></td></tr>';
              $('#miner-stats-table').append(totalRow);
            }

            function createMinerPayTable(data, marketLastBTC, marketLastUSDT) {
                let last24hPaid = 0;
                let last7DaysPaid = 0;
                let totalPaid = 0;

                if (data.results.length > 0) {
                    const now = new Date();
                    const last24hDate = new Date(now - 24 * 60 * 60 * 1000);
                    const last7DaysDate = new Date(now - 7 * 24 * 60 * 60 * 1000);

                    for (let i = 0; i < data.results.length; i++) {
                        for (var j = 0; j < data.results[i]['txn'].outputs.length; j++) {
                            if (data.results[i]['txn'].outputs[j].to === $('#address').val()) {
                                const payoutDate = new Date(data.results[i]['txn'].time * 1000);
                                const payoutAmount = parseFloat(data.results[i]['txn'].outputs[j].value);

                                if (payoutDate >= last24hDate) {
                                    last24hPaid += payoutAmount;
                                }

                                if (payoutDate >= last7DaysDate) {
                                    last7DaysPaid += payoutAmount;
                                }

                                totalPaid += payoutAmount;
                            }
                        }
                    }
                }

                const tableHTML = `
                    <table id="miner-pay" class="table">
                        <thead>
                            <tr>
                                <th>Time Period</th>
                                <th>Paid</th>
                                <th>Value USDT</th>
                                <th>Value BTC</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Last 24h</td>
                                <td id="last-24h-paid-value">${last24hPaid.toFixed(8)} YDA</td>
                                <td id="last-24h-usdt">${(last24hPaid * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="last-24h-btc">${(last24hPaid * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                            <tr>
                                <td>Last Week</td>
                                <td id="last-7-days-paid-value">${last7DaysPaid.toFixed(8)} YDA</td>
                                <td id="last-7-days-usdt">${(last7DaysPaid * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="last-7-days-btc">${(last7DaysPaid * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                            <tr>
                                <td>Total</td>
                                <td id="total-paid-value">${totalPaid.toFixed(8)} YDA</td>
                                <td id="total-usdt">${(totalPaid * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="total-btc">${(totalPaid * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                        </tbody>
                    </table>
                `;

                $('#miner-pay-container').html(tableHTML);
            }

            function createEstMiningProfitTable(marketLastBTC, marketLastUSDT, currentNetHashrate, avgNetHashrate, minerHashrate) {
                console.log("Funkcja createEstMiningProfitTable została wywołana.");

                let estMiningProfit = 0;
                const dailyCoins = 144 * 11.25;

                estMiningProfit = minerHashrate / currentNetHashrate  * dailyCoins;

                console.log("Wartość estMiningProfit:", estMiningProfit);
                console.log("Wartość marketLastBTC:", marketLastBTC);
                console.log("Wartość marketLastUSDT:", marketLastUSDT);
                console.log("Wartość currentNetHashrate:", currentNetHashrate);
                console.log("Wartość avgNetHashrate:", avgNetHashrate);
                console.log("Wartość minerHashrate:", minerHashrate);

                const tableHTML = `
                    <table id="est-profit" class="table">
                        <thead>
                            <tr>
                                <th>Estimate Mining Profits</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Daily</td>
                                <td id="daily-paid-value">${estMiningProfit.toFixed(8)} YDA</td>
                                <td id="daily-usdt">${(estMiningProfit * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="daily-btc">${(estMiningProfit * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                            <tr>
                                <td>Weekly</td>
                                <td id="weekly-paid-value">${(7 * estMiningProfit).toFixed(8)} YDA</td>
                                <td id="weekly-usdt">${(7 * estMiningProfit * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="weekly-btc">${(7 * estMiningProfit * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td id="monthly-value">${(30 * estMiningProfit).toFixed(8)} YDA</td>
                                <td id="monthly-usdt">${(30 * estMiningProfit * marketLastUSDT).toFixed(8)} USD</td>
                                <td id="monthly-btc">${(30 * estMiningProfit * marketLastBTC).toFixed(8)} BTC</td>
                            </tr>
                        </tbody>
                    </table>
                `;

                $('#est-profit-container').html(tableHTML);
            }
        });
</script>


<style>

body {
  background-color: #D3D3D3;
  margin-left: 12%;
  margin-right: 12%;
}

.header {
  padding: 10px;
  text-align: left;
  font-size: 50px;
}

.box {
  width: 100%;
  height: 120px;
  padding: 3px;
  padding-left: 15px;
  font-size: 22px;
  font-weight: bolder;
  color: whitesmoke;
  font-family: "Audiowide", sans-serif;
  box-sizing: border-box;
  background-image:linear-gradient(#A9A9A9, #696969);
  opacity: 0.9;
}

.box2 {
  width: 100%;
  height: 210px;
  box-sizing: border-box;
}

.box3 {
  width: 100%;
  height: 210px;
  padding: 3px;
  padding-left: 20px;
  font-size: 14px;
  color: whitesmoke;
  text-decoration-color: darkred;
  font-family: "Audiowide", sans-serif;
  box-sizing: border-box;
  background-image:linear-gradient(#A9A9A9, #696969);
  opacity: 0.9;
}

.column {
  float: left;
  width: 25%;
  padding: 10px;
}

.column2 {
  float: left;
  padding: 20px;
  width: 50%;
  padding: 10px;
}

.column3 {
  float: center;
  padding: 20px;
  width: 100%;
  padding: 10px;
}

.page-item.active a {
  background-color: #A9A9A9;
  color: #fff;
}

@media (max-width: 1100px) {
  .column {
    width: 100%;
  }
  .column2 {
    width: 100%;
  }
}

.button {
  width: 24%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 6px 14px;
  font-family: -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
  border-radius: 6px;
  border: none;

  background: #A9A9A9;
  box-shadow: 0px 0.5px 1px rgba(0, 0, 0, 0.1), inset 0px 0.5px 0.5px rgba(255, 255, 255, 0.5), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.12);
  color: black;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button:focus {
  box-shadow: inset 0px 0.8px 0px -0.25px rgba(255, 255, 255, 0.2), 0px 0.5px 1px rgba(0, 0, 0, 0.1), 0px 0px 0px 3.5px rgba(58, 108, 217, 0.5);
  outline: 0;
}

.footer {
  background-color: #f1f1f1;
  padding: 10px;
  text-align: center;
}

table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
  font-size: 14;
}

tr:nth-child(even){background-color: #A9A9A9}

th {
  background-color: #696969;
  color: whitesmoke;
}

li {
  display: inline;
}
</style>
</html>
